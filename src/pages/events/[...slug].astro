---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Calendar, MapPin, ArrowLeft } from "lucide-react";
import { PretixWidget } from "@/components/PretixWidget";

export async function getStaticPaths() {
    const events = await getCollection("events");
    return events.map((event) => ({
        params: { slug: event.slug },
        props: { event },
    }));
}

const { event } = Astro.props;
const { Content } = await event.render();
---

<Layout title={`${event.data.title} - AWS User Group Jakarta`}>
    <div class="bg-muted/30 py-12 md:py-20">
        <div class="container max-w-4xl mx-auto px-4 md:px-6">
            <Button
                variant="ghost"
                className="mb-8 pl-0 hover:pl-0 hover:bg-transparent text-muted-foreground hover:text-foreground"
                asChild
            >
                <a href="/events">
                    <ArrowLeft className="mr-2 h-4 w-4" /> Back to Events
                </a>
            </Button>

            <div class="space-y-6">
                <Badge className="bg-primary text-black hover:bg-primary/90">
                    {event.data.type}
                </Badge>

                <h1
                    class="text-4xl font-extrabold tracking-tight lg:text-5xl text-foreground"
                >
                    {event.data.title}
                </h1>

                <div
                    class="flex flex-col gap-4 sm:flex-row sm:items-center sm:gap-8 text-muted-foreground font-medium"
                >
                    <div class="flex items-center">
                        <Calendar className="mr-2 h-5 w-5 text-primary" />
                        {
                            event.data.date.toLocaleDateString("en-US", {
                                weekday: "long",
                                year: "numeric",
                                month: "long",
                                day: "numeric",
                            })
                        }
                    </div>
                    <div class="flex items-center">
                        <MapPin className="mr-2 h-5 w-5 text-primary" />
                        {event.data.location}
                    </div>
                </div>

                {
                    event.data.registrationUrl && (
                        <div class="pt-2">
                            <Button
                                className="bg-primary hover:bg-primary/90 text-white font-bold"
                                size="lg"
                                asChild
                            >
                                <a
                                    href={event.data.registrationUrl}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    Register Now
                                </a>
                            </Button>
                        </div>
                    )
                }
            </div>
        </div>
    </div>

    <div class="container max-w-4xl mx-auto px-4 md:px-6 py-12">
        {
            event.data.image && (
                <div class="rounded-2xl overflow-hidden mb-12 border border-border/50 shadow-lg aspect-video relative">
                    <img
                        src={event.data.image}
                        alt={event.data.title}
                        class="object-cover w-full h-full"
                    />
                </div>
            )
        }

        <article
            class="prose prose-lg dark:prose-invert max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-a:text-primary prose-img:rounded-xl"
        >
            <Content />
        </article>

        {
            event.data.pretixUrl && (
                <div class="mt-12 pt-12 border-t border-border/50">
                    <h2 class="text-2xl font-bold tracking-tight mb-6">
                        Register for This Event
                    </h2>
                    <div class="bg-muted/30 rounded-lg p-6 md:p-8">
                        <PretixWidget
                            client:load
                            eventUrl={event.data.pretixUrl}
                            subevent={event.data.pretixSubevent}
                            listType={event.data.pretixListType}
                            className="w-full"
                        />
                    </div>
                </div>
            )
        }
    </div>
</Layout>
